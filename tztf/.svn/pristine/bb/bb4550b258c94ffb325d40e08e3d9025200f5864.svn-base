<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="author" content="movinginfo"/>
    <title>黄岩公共突发事件预警发布平台-发布责任单位-预警发布-填写发布申请</title>
    <link rel="stylesheet" href="/static/css/global.css">
    <link rel="stylesheet" href="/static/css/publishApplication.css">
    <!--日历控件开始-->
    <link rel="stylesheet" href="/static/js/datepicker/css/jqueryui.min.css">
    <link rel="stylesheet" href="/static/js/datepicker/css/jquery-ui-timepicker-addon.css">
    <link rel="stylesheet" href="/static/js/datepicker/css/timepick.css">
    <!--日历控件结束-->
     <style>
		.popup_bd{
			max-height:330px;
			overflow-x: auto;
		}
        .checkbox_style input{
            float: left;
            width: 0px !important;
            height: 10px !important;
            padding: 0px !important;
            margin: 0px !important;
        }
       .typeColor,.reviewer,.issuer{
            width: 229px;
            height: 32px;
            color: #bebed8;
       } 
       .type{
            width: 229px;
            height: 32px;
            color: #bebed8;
       } 
       .publishForm{
            width: 172px;
            height: 35px;
            line-height: 35px;
            color: #FFF;
            text-align: center;
            background: #0f8ffe;
            border-radius: 3px;
            margin-right: 12px;
            display: inline-block;
        }
        .g-bd-left-con ul li .m-checkbox span{
            text-align: left;
            width:80px;
            margin-left:12px;
        }
            .channelContentSel{
               width:92%;
                border: 1px solid rgba(190, 190, 216, 0.2);
                background: rgba(0, 0, 0, 0.1);
                line-height: 34px;
                padding: 0 15px;
                border-radius: 4px;
            }
        .file {
            position: relative;
            display: inline-block;
            background: #D0EEFF;
            border: 1px solid #99D3F5;
            border-radius: 4px;
            padding: 7px 15px;
            overflow: hidden;
            color: #1E88C7;
            text-decoration: none;
            text-indent: 0;
            line-height: 20px;
            margin-right:20px;
        }
        .file input {
            position: absolute;
            font-size: 100px;
            right: 0;
            top: 0;
            opacity: 0;
        }
        .file:hover {
            background: #AADFFD;
            border-color: #78C3F3;
            color: #004974;
            text-decoration: none;
        }
        .m-select select.m-text-input,.m-select .m-text-input-text {
            border: 1px solid rgba(190,190,216,0.2);
            border-radius: 5px;
            height: 32px;
            background: rgba(0,0,0,0.1);
        }
        .m-select .m-text-input-text{
            padding:0 15px;
            margin-right:5px;
        }
        .checkboxAreaAll,.checkboxChannelAll{
            width: 16px;
            height: 16px;
            float: left;
            cursor: pointer;
            margin-top: 10px;
            text-align: center;
            background-image: url(/static/images/oncheck_img.png);
            background-repeat: no-repeat;
        }
        .m-button{
            margin-top:0px;
        }
        .query_hd li{
            margin-bottom: 5px;
        }
        .m-button-bottom{
            position: relative;
            bottom: -20px;
            margin-bottom: 20px;
            float: left;
        }
        .bubble-box {
            bottom: -94%;
        }
        .bubble-box .m-arrow{
            bottom: 60px;
        }
        .m-select select option{
            background:rgba(0, 0, 0, 0.8);
            color: #FFF;
        }
        .m-poplayer-table tr td {
		    text-align: left;
		    line-height: 25px;
		    text-overflow: initial;
		    white-space: normal;
		}
		.m-poplayer-table tr:first-child td:first-child{
            width: 16%;
        }
        .popup_bd{
            max-height:390px;
            overflow-x: auto;
        }
        .query_hd li:hover, .query_hd li.channelContentSel-selected {
            border: 2px solid #4a85f2;
        }
    </style>
</head>
<body>
     <!--弹窗开始-->
    <div class="m-poplayer">
        <div class="popup_con"></div>
    </div>
    <!--弹窗结束-->
     <!--时间轴开始-->
    <div class="m-event mb10">
        <div class="m-event-schedule">
            <div class="m-event-timeAxis">
                <!--事件进度时间轴底部开始-->
                <div class="m-timeAxis-bg">
                    <dl>
                        <dd></dd>
                    </dl>
                    <dl>
                        <dd></dd>
                    </dl>
                    <dl>
                        <dd></dd>
                    </dl>
                    <dl>
                        <dd></dd>
                    </dl>
                </div>
                <!--事件进度时间轴底部结束-->
                <!--事件进度时间轴进度开始-->
                <div class="m-timeAxis-con">
                    <dl>
                        <dd><i></i></dd>
                    </dl>
                </div>
                <!--事件进度时间轴进度结束-->
            </div> 
            <!--事件进度说明开始-->
            <li class="m-event-explain">
                <p> 
                    #if($!alarm.pubState == "2")
                         <span>审核退回</span>
                    #end
                    #if($!alarm.pubState == "9")
                        <span>审核解除退回</span>
                    #end
                   
                    <span>发布中心审核</span>
                    <span>发布平台执行</span>
                    <span>发布完成</span>
                </p>
            </li>
            <!--事件进度说明开始-->
        </div>   
    </div>                          
    <!--时间轴结束-->
<form action="" method="post" id="form" name="form">
<input type = "hidden" id="id" name = "id" value="$!{alarm.id}">
<input type = "hidden" id="pubNo" name = "pubNo" value="$!{alarm.pubNo}">
<input type = "hidden" id="pubState" name = "pubState" value="$!{alarm.pubState}">
<input type = "hidden" id="imagePath" name = "imagePath" value="$!{alarm.imagePath}">
<input type = "hidden" id="version" name = "version" value="$!{alarm.version}">
<input type = "hidden" id="alarmTypeName" name = "alarmTypeName" value="$!{alarm.alarmTypeName}">
<input type = "hidden" id="typeT" name = "type" value="$!{alarm.type}">
<input type = "hidden" id="typeId" name = "typeId" value="$!{alarm.typeId}">
<input type = "hidden" id="pid" name = "pid" value="$!{alarm.pid}">
    <!--内容开始-->
    <div class="g-bd-cont">
        <!--标题开始-->
        <div class="g-bd-tit">
            <span>$!{departmentName}发布申请</span><span class="filenum"></span>
        </div>
        <!--标题结束-->
        <!--左边开始-->
        <div class="g-bd-left">
            <!--内容开始-->
            <div class="g-bd-left-con">
                <ul>
                    <!--标题开始-->
                    <li><span>标题</span><input type="text" id="title" name="title" class="m-text-input" value="$!{alarm.title}" /></li>
                    <!--标题结束-->
                </ul>
                
                 #if($alarm.type =="alarm")
                <!--预警部分  -->
                <ul class="m-sets">
                    <!--信息类别开始-->
                    <li>
                        <span>信息类别</span>
                        <div class="m-select">
                                <select id="type" class="type m-text-input" name="type">
                                 #foreach($alarmName in ${alarmTypeName})  
                                     <option value="$!{alarmName.namecn}">$!{alarmName.namecn}</option>   
                                 #end 
                                </select>
                        </div>
                    </li>
                    <!--信息类别结束-->
                    <!--预警级别开始-->
                    <li class="pl10">
                        <span>预警级别</span>
                        <div class="m-select">
                            <select id="typeColor" class="typeColor m-text-input" name="level">
                            </select>
                        </div>
                    </li>
                    <!--预警级别结束-->
                </ul>
                 <!--预警部分  -->
                 #elseif($!alarm.type == "event") 
                 <!--事件部分  -->
                <ul class="m-sets">
                    <!--信息类别开始-->
                    <li>
                        <span>信息类别</span>
                        <div class="m-select">
                                <select id="type" class="type m-text-input" name="typeT">
                                 #foreach($eventName in ${eventType})  
                                     <option value="$!{eventName.displayName}">$!{eventName.displayName}</option>   
                                 #end 
                                </select>
                        </div>
                    </li>
                    <!--信息类别结束-->
                    <!--预警级别开始-->
                    <li class="pl10">
                        <span>预警级别</span>
                        <div class="m-select">
                            <select id="typeColor" class="typeColor m-text-input" name="level">
                                <option value="蓝色">蓝色</option>
                                <option value="黄色">黄色</option>
                                <option value="橙色">橙色</option>
                                <option value="红色">红色</option>
                            </select>
                        </div>
                    </li>
                    <!--预警级别结束-->
                </ul>
                 <!--事件部分  -->
                 #end
                 
                <ul class="m-sets">
                    <!--发布时间开始-->
                    <li><span>发布时间</span><input class="inputTimepick m-text-input" type="text" name="pubDate" id="basic_example_1" value=""></li>
                    <!--发布时间结束-->
                    <!--发布时效开始-->
                    <li class="pl10">
                        <span>发布时效</span>
                        <div class="m-select">
                           <input type="text" id="prescription" name="duration" value="$!{alarm.duration}" class="m-text-input-text">小时
                        </div>
                    </li>
                    <!--发布时效结束-->
                </ul>
                
                
<!--jinb乡镇区域改动  -->                
                
               <ul>
                    <!--发布范围开始-->
                     <li>
                        <span class="fl">发布范围</span>
                        <div class="checkbox_bd">
                            <div class="m-checkbox">
                                <input name="checkboxAreaAll" type="checkbox" class="radioclass" value="">
                                <i class="checkboxAreaAll"></i>
                                <span>全选</span>
                            </div>
                            #foreach($area in ${areaAll})  
                       
                            <div class="m-checkbox checkboxArea">
                                <input name="pubRangeName" type="checkbox" class="radioclass" value="$!area.country">
                                <i class="checkbox" data-id="$!area.abb"></i>
                                <span class="checkCountry" style="CURSOR: pointer;">$!area.country</span>
                            </div>
                             #end 
                        </div>
                    </li>
                    <!--发布范围结束-->
                </ul>
              
                #foreach($areaAll in ${areaAll})  
                  <ul style="display:none;" id="$!areaAll.abb" name="countryUl">
                    <!--发布范围开始-->
                    <li>
                        <span class="fl">乡镇范围</span>
                        <div class="checkbox_bd">
                            <div class="m-checkbox">
                                <input name="checkboxAreaAll" type="checkbox" class="radioclass" value="">
                                <i class="checkboxAreaAll" data-id="$!areaAll.abb"></i>
                                <span>全选</span>
                            </div>
                            #foreach($area in ${areaAllTown})  
                                #if($!area.country == $!areaAll.country)
                                <div class="m-checkbox checkboxArea">
                                    <input name="pubRangeNameTown" type="checkbox" class="radioclass $!areaAll.abb" value="$!{area.town}" #if( $alarm.pubRangeName.indexOf($!area.town) >-1) checked="true" #end>
                                    <i class="checkbox #if( $alarm.pubRangeName.indexOf($!area.town) >-1) on_check #end"></i>
                                    <span>$!{area.town}</span>
                                </div>
                                #end
                             #end 
                        </div>
                    </li>
                    <!--发布范围结束-->
                 </ul>
                #end 
                
                
<!--jinb乡镇区域改动  -->
                <ul>
                    <!--发布渠道开始-->
                    <li>
                        <span class="fl">发布渠道</span>
                        <div class="checkbox_bd">
                        
                            <div class="m-checkbox">
                                <input name="checkboxAreaAll" type="checkbox" class="radioclass" value="">
                                <i class="checkboxChannelAll"></i>
                                <span>全选</span>
                            </div>
                             #foreach($rc in ${releaseChannel}) 
                             <div class="m-checkbox checkbox_style">
                                <input name="channelCheckBoxes" type="checkbox" class="radioclass" value="channel_$!rc.nameEn" #if( $channel.indexOf($!rc.name) >-1) checked="true" #end>
                                <i class="checkbox #if( $channel.indexOf($!rc.name) >-1) on_check #end"></i>
                                <span>$!rc.name</span>
                            </div> 
                             #end 
                        
                        </div>
                    </li>
                    <!--发布渠道结束-->
                </ul>
                
                <!--标题位置开始-->
                <!-- 
                <ul>
                    <li>
                        <span>标题位置</span>
                        <div class="checkbox_bd">
                            <div class="m-checkbox">
                                <input name="need_inv" type="radio" class="radioclass" value="开头">
                                <i class="radio on_input_check"></i>
                                <span>开头</span>
                            </div>
                            <div class="m-checkbox">
                                <input name="need_inv" type="radio" class="radioclass" value="结尾">
                                <i class="radio"></i>
                                <span>结尾</span>
                            </div>
                        </div>
                    </li>
                </ul>
                 -->
                <!--标题位置结束-->
                
                <ul>
                    <!--发布内容开始-->
                    <li>
                        <span class="fl">发布内容</span>
                        <textarea class="m-text-textarea" name="content" id="limitWord">$!{alarm.content}</textarea>
                        <p>限制200字,还剩<span id="textCount">0</span>字</p>
                    </li>
                    <!--发布内容结束-->
                </ul>                
                <ul class="m-sets-sets">
                    <!--操作人员开始-->
                    <li>
                        <span>操作人员</span>
                        <div class="m-select">
                                <input class="issuer m-text-input-text" name="publisher" value="$!alarm.publisher">
                        </div>
                    </li>
                    <!--审稿人员结束-->                    
                    <!--发布时效开始-->
                    <li class="pl10">
                        <span>签发人员</span>
                         <div class="m-select">
                                <input id="issuer" class="issuer m-text-input-text" name="issuer" value="$!alarm.issuer">
                        </div>
                    </li>
                    <!--签发人员结束-->
                </ul>       
            </div>
            <!--内容结束-->
        </div>
    <!--左边结束-->

    <!--右边开始-->
        <div class="g-bd-right form_right"> 
            <!--渠道总汇开始-->       
            <div class="g-bd-right-modular h100" style="position: relative;">
                <!--标题开始-->
                <div class="g-bd-tit">
                    <span>发布预览</span>
                    <!--切换开始-->
                    <ul class="query_hd fr">
                         #foreach($rc in ${releaseChannel})  
                            <li class="channelContentBtnSel">${rc.name}</li>
                         #end 
                    </ul>
                    <!--切换结束-->
                </div>
                <!--标题结束-->
                <!--内容开始-->   
                 #foreach($rc in ${releaseChannel})  
                   <div class="textarea-wrapper" style="clear:both;margin-bottom:5px">
                        <textarea class="channelContentSel" data-length="$!rc.maxLength" name="channel_$!rc.nameEn" style="height: 100px;" placeholder="请输入$!rc.name发布内容">#foreach($releaseInstance in ${releaList})#if($!releaseInstance.channelId ==$!rc.id)$!{releaseInstance.content}#end#end
                        </textarea>
                         <div class="text-left-words">还可以输入$!rc.maxLength字</div>
                    </div>
                 #end 
                <!--内容结束-->
                <!--按钮1开始-->                
                <div class="m-button">
                    <a id="publishForm" class="publishForm" style="cursor:pointer">生成申请表单</a>
                    <a href="javascript:;" class="file" style="top:13px;">领导签字后上传预览
                            <input type="file" name="file" id="file" onChange="FileUpload()">
                        </a>
                </div>
                <!--按钮1结束-->
                 <ul style="width: 100%; margin-top: 60px;">
                    <!--审批单开始-->
                    <li>
                        <span class="fl" style="line-height: 30px; text-indent: 0.8em;">审批单</span>
                        <div class="m-text-textarea dpi" style="width:92%">
                        #if($!alarm.imagePath != "")
                            <img src="/upload/$!{alarm.imagePath}" style ="height:99px;" />
                            #else
                            <h3>未上传</h3> 
                         #end 
                        </div>
                    </li>
                    <!--发布内容结束-->
                </ul>
                <!--按钮2开始-->                
                <div class="m-button-bottom">
                    <button class="abandon">放弃</button>
                    <button class="report">上报发布中心</button>
                </div>
                <!--按钮2结束-->
            </div>
            <!--渠道总汇开始-->  
        </div>
    <!--右边结束-->
    </div>
    <!--内容开始-->
</form>   

    <!--js开始-->
    <script type="text/javascript" src="/static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="/static/js/public.js"></script>
    <script type="text/javascript" src="/static/js/publishApplication.js"></script>
     <script type="text/javascript" src="/static/js/remakeApplication.js"></script>
     <script type="text/javascript" src="/static/js/application.js"></script>
     <script type="text/javascript" src="/static/js/ajaxfileupload.js"></script>
    <!--日历开始-->    
    <script type="text/javascript" src="/static/js/datepicker/js/jquery-ui.js"></script>
    <script type="text/javascript" src="/static/js/datepicker/js/jquery-ui-sliderAccess.js"></script>
    <script type="text/javascript" src="/static/js/datepicker/js/jquery-ui-timepicker-addon.js"></script>
    <script type="text/javascript" src="/static/js/datepicker/js/jquery-ui-timepicker-zh-CN.js"></script>
    <script type="text/javascript" src="/static/js/datepicker/js/useDatepick.js"></script>
    <!--日历结束-->  
    <!--js开始-->
</body>
</html>

<!-- 公用自写 -->
<script type="text/javascript">
$(function(){
	var imagePathT = $("img").attr("src");
    $("img").css("cursor","pointer").click(function(){
        window.open(imagePathT);
    });
});
var colorLevel = {
        "红色": "(I级/特别重大)",
        "橙色": "(II级/严重)",
        "黄色": "(III级/较重)",
        "蓝色": "(IV级/一般)",
    };
$('document').ready(function(){
    //生成发布表单
    $("#publishForm").click(function(){
        $.ajax({
            cache: true,
            type: "POST",
            url:"${base}/sev/alarm/createForm",
            data:$('#form').serialize(),// 你的formid
            async: false,
            error: function(request) {
                alert("Connection error");
            },
            success: function(data) {
                $("#imagePath").val(data);
                window.location.href="${base}/sev/alarm/download?data="+data;
            }
        });
    });
    $(".abandon").click(function(){
        history.back(-1);
    });
});
</script>

<!-- 事件部分 -->
#if($!alarm.type =="event")
<script type="text/javascript">
var allEventType = #if($!allEventType.length!=0) $!allEventType #else {} #end  ;
$('document').ready(function(){
	var eventTT = "$!{alarm.alarmTypeName}";
    var nedEvent = eventTT.substring(0,eventTT.length-2);
    var nedColor = eventTT.substring(eventTT.length-2,eventTT.length);
    $("#type").find("option[value='"+nedEvent+"']").prop("selected",true);
    $("#typeColor").find("option[value='"+nedColor+"']").prop("selected",true);
    
    $("#typeColor").click(function(){
        var eventType = $('#type option:selected').text();
        var color = $('#typeColor option:selected').text();
        $("#alarmTypeName").val(eventType+color);
        var Level = "";
        for(var key in colorLevel){
            if(key === color){
                level = colorLevel[key];
            }
        }
        var text = "$!{departmentName}发布的"+eventType+color+"预警"+level;
        $("#title").val(text);
        var appContent = "$!{departmentName}"+$("#basic_example_1").val()+"发布"+eventType+color+"预警：";
        $("#limitWord").val(appContent);
        $('.channelContentSel').val(appContent);
        
    });
    $("#type").click(function(){
        var eventType = $('#type option:selected').text();
        var color = $('#typeColor option:selected').text();
        $("#alarmTypeName").val(eventType+color);
        var Level = "";
        for(var key in colorLevel){
            if(key === color){
                level = colorLevel[key];
            }
        }
        for(var i=0;i<allEventType.length;i++){
            var info = allEventType[i];
            if(info.displayName == eventType){
                 $("#typeId").val(info.id);
            }
        }
        var text = "$!{departmentName}发布的"+eventType+color+"预警"+level;
        $("#title").val(text);
        $("#typeColor").find("option").eq(0).prop("selected",true);
        $("#typeColor").trigger("click");
    });
});
</script>
#end
<!-- 事件部分 -->

<!-- 预警部分 -->
#if($!alarm.type =="alarm")
<script type="text/javascript">
    var allAlarmType = #if($!alarmType.length!=0) $!alarmType #else {} #end  ;
    var myArray=new Array();
    $('document').ready(function(){
    	var eventTT = "$!{alarm.alarmTypeName}";
        var nedEvent = eventTT.substring(0,eventTT.length-2);
        var nedColor = eventTT.substring(eventTT.length-2,eventTT.length);
        $("#type").find("option[value='"+nedEvent+"']").prop("selected",true);
        var typeData = $("#type").val();
        var typeColorData = "";
        for(var i=0;i<allAlarmType.length;i++){
            var info = allAlarmType[i];
            if(info.namecn == typeData){
                var typeName = info.caption;
                var colorName = typeName.substring(typeName.length-2,typeName.length);
                typeColorData += "<option value="+typeName+">"+colorName+"</option>";  
            }
        }
        $("#typeColor").empty();
        $("#typeColor").append(typeColorData);
        $("#typeColor").find("option[value='"+nedColor+"']").prop("selected",true);
    	
        $("#typeColor").click(function(){
            var type = $('#typeColor option:selected').val();
            var color = $('#typeColor option:selected').text();
            $("#alarmTypeName").val(type);
            var Level = "";
            for(var key in colorLevel){
                if(key === color){
                    level = colorLevel[key];
                }
            }
            var text = "$!{departmentName}发布的"+type+"预警"+level;
            $("#title").val(text);
            for(var i=0;i<allAlarmType.length;i++){
                var info = allAlarmType[i];
                if(info.caption == type){
                    var time = info.validity;
                    $("#typeId").val(info.id);
                    $("#prescription").val(time);
                    var appContent = "$!{departmentName}"+$("#basic_example_1").val()+"发布"+type+"预警："+info.content;
                    $("#limitWord").val(appContent);
                    $('.channelContentSel').val(appContent);
                    
                }
            }
            
        })
        $("#type").click(function(){
            var typeData = $("#type").val();
            var typeColorData = "";
            for(var i=0;i<allAlarmType.length;i++){
                var info = allAlarmType[i];
                if(info.namecn == typeData){
                    var typeName = info.caption;
                    var colorName = typeName.substring(typeName.length-2,typeName.length);
                    typeColorData += "<option value="+typeName+">"+colorName+"</option>";  
                }
            }
            $("#typeColor").empty();
            $("#typeColor").append(typeColorData);
            $("#typeColor").find("option").eq(0).prop("selected",true);
            $("#typeColor").trigger("click");
        })
    });
</script>
#end
<!-- 预警部分 -->

<!-- 公用 -->
<script type="text/javascript">
$('document').ready(function(){
	/*页面加载进来时发布内容与时间同步*/
	var type = $('#type option:selected').text();
    var color = $('#typeColor option:selected').text();
    var appContent = "$!{departmentName}"+$("#basic_example_1").val()+"发布"+type+color+"预警："; 
    var txt1 = $("#limitWord").val();
    var index1 = txt1.indexOf("：");
    var subTxt = txt1.substring(0,index1+1);
    txt1 = txt1.replace(subTxt,appContent);
    $("#limitWord").val(txt1);
    $("#limitWord").trigger("keyup");
    /*页面加载进来判断是否需要勾上全选框*/
	if($('.checkboxArea input[name="pubRangeName"]:checked').length==$('.checkboxArea input[name="pubRangeName"]').length ){
        $(".checkboxAreaAll").addClass("on_check");
        $(".checkboxAreaAll").parent().find(".radioclass").prop("checked", true);
    }
	if($('.checkbox_style input[name="channelCheckBoxes"]:checked').length==$('.checkbox_style input[name="channelCheckBoxes"]').length){
        $(".checkboxChannelAll").addClass("on_check");
        $(".checkboxChannelAll").parent().find(".radioclass").prop("checked", true);
        
        refreshChannelBtns();
    }
	$(".checkCountry").click(function(){
        var a=$(this).parent().find("i").attr("data-id");
        $(".checkCountry").removeClass("checkToTown");
        $(this).addClass("checkToTown");
        debugger;
         var $allcountry = $('ul[name="countryUl"]');
         $.each($allcountry, function(i,l){
                if($(l).attr("id")==a){
                    $(l).show();
                }else{
                    $(l).hide();
                }
        });
    });

	/* checkbox*/
       var $allcountry = $('ul[name="countryUl"]');
       $.each($allcountry, function(i,l){
    	   var dataId = $(l).attr("id");
           if($('.checkboxArea .'+dataId+':checked').length==$('.checkboxArea .'+dataId+'').length ){
               $(l).find(".checkboxAreaAll").addClass("on_check");
               $(l).find(".checkboxAreaAll").parent().find(".radioclass").prop("checked", true);
           }
           if($('.checkboxArea .'+dataId+':checked').length>0){
        	   $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".radioclass").prop("checked", true);
               $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".checkbox").addClass("on_check");
           }
      });
       if($('.checkboxArea input[name="pubRangeName"]:checked').length==$('.checkboxArea input[name="pubRangeName"]').length ){
           $(".checkCountry").parents(".checkbox_bd").find(".checkboxAreaAll").addClass("on_check");
           $(".checkCountry").parents(".checkbox_bd").find(".checkboxAreaAll").parent().find(".radioclass").prop("checked", true);
           
       }
	 /*复选框选中全选区县*/
	    $(".checkboxAreaAll").on("click", function () {
	        debugger;
	        $(this).toggleClass("on_check");
	        // 获取父节点是否选中-2017-09-04-倪佳慧-修改

	        if($(this).is('.on_check')){
	             $(this).parent().find("input.radioclass").prop("checked","true");
	        }else{
	             $(this).parent().find("input.radioclass").removeAttr("checked");
	        }
	        var isChange = $(this).parent().find(".radioclass").prop("checked");
	        var dataId = $(this).attr("data-id");
	        if(isChange){ // 如果选中,则父节点下的所有的子节点都选中
	          // 获取当前checkbox节点的兄弟节点下的所有的checkbox子节点选中
	          $(this).parents(".checkbox_bd").find(".checkboxArea").find(".radioclass").prop("checked", true);
	          $(this).parents(".checkbox_bd").find(".checkboxArea").find(".checkbox").addClass("on_check");
	          if(dataId !=undefined){
	              $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".radioclass").prop("checked", true);
	              $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".checkbox").addClass("on_check");
	              //$('.checkbox[data-id="'+dataId+'"]').trigger("click");
	          }else{
	            //  $(".checkbox").addClass("on_check");
	             // $(".checkboxAreaAll").addClass("on_check");
	            //  $(".radioclass").prop("checked", true);
	              $(".checkboxAreaAll").parents(".checkbox_bd").find(".radioclass").prop("checked", true);
	              $(".checkboxAreaAll").parents(".checkbox_bd").find(".checkbox").addClass("on_check");
	              $(".checkboxAreaAll").addClass("on_check");
	              $('ul[name="countryUl"]').hide();
	          }
	        }else{ // 未选中，取消全选
	          // 获取当前checkbox节点的兄弟节点下的所有的checkbox子节点选中
	              $(this).parents(".checkbox_bd").find(".checkboxArea").find(".radioclass").removeAttr("checked");
	              $(this).parents(".checkbox_bd").find(".checkboxArea").find(".checkbox").removeClass("on_check");
	              $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".radioclass").prop("checked", false);
	              $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".checkbox").removeClass("on_check");
	              if(dataId !=undefined){
	                  $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".radioclass").prop("checked", false);
	                  $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".checkbox").removeClass("on_check");
	                  //$('.checkbox[data-id="'+dataId+'"]').trigger("click");
	              }else{
	                  $(".checkboxAreaAll").parents(".checkbox_bd").find(".radioclass").prop("checked", false);
	                  $(".checkboxAreaAll").parents(".checkbox_bd").find(".checkbox").removeClass("on_check");
	                  $(".checkboxAreaAll").removeClass("on_check");
	                  $('ul[name="countryUl"]').hide();
	              }

	        }
	        //jinb
	       
	       
	    })
   
      /*复选框选中全选渠道*/
    $(".checkboxChannelAll").on("click", function () {
        $(this).toggleClass("on_check");
        // 获取父节点是否选中-2017-09-04-倪佳慧-修改
        
        if($(this).is('.on_check')){
             $(this).parent().find("input.radioclass").prop("checked","true");
             refreshChannelBtns();
             $('.textarea-wrapper').show();
        }else{
             $(this).parent().find("input.radioclass").removeAttr("checked");
        }
        var isChange = $(this).parent().find(".radioclass").prop("checked");
        
        if(isChange){ // 如果选中,则父节点下的所有的子节点都选中
          // 获取当前checkbox节点的兄弟节点下的所有的checkbox子节点选中
          $(this).parents(".checkbox_bd").find(".checkbox_style").find(".radioclass").prop("checked", true);
          $(this).parents(".checkbox_bd").find(".checkbox_style").find(".checkbox").addClass("on_check");
          refreshChannelBtns();
        }else{ // 未选中，取消全选
          // 获取当前checkbox节点的兄弟节点下的所有的checkbox子节点选中
          $(this).parents(".checkbox_bd").find(".checkbox_style").find(".radioclass").removeAttr("checked");
          $(this).parents(".checkbox_bd").find(".checkbox_style").find(".checkbox").removeClass("on_check");
          refreshChannelBtns();
        }
    });
    /*日历加载*/
    $('#basic_example_1').datetimepicker({//时间格式化
        timeFormat: "HH:mm",
        dateFormat: "yy-mm-dd",
        showMonthAfterYear: false,
        changeMonth: true,
        changeYear: true,
        yearRange: "1990:2050",
        setColorstyle: false,
        maxDate: new Date().format("yyyy-MM-dd HH:mm"),
        //maxDate: new Date($('#basic_example_1').val() + ":00").format("yyyy-MM-dd"),
        Colorstyle: { "topColor": "#900", "bodyColor": "#000", "activeColor": "#900", "sliderColor": "#900", "hoverColor": "#900" },//定义外观颜色
        onSelect: function () {//选择日期后执行的操作  
        	 var type = $('#type option:selected').text();
             var color = $('#typeColor option:selected').text();
             var appContent = "$!{departmentName}"+$("#basic_example_1").val()+"发布"+type+color+"预警："; 
             var txt1 = $("#limitWord").val();
             var index1 = txt1.indexOf("：");
             var subTxt = txt1.substring(0,index1+1);
             txt1 = txt1.replace(subTxt,appContent);
             $("#limitWord").val(txt1);
             $("#limitWord").trigger("keyup");
            //getTimeList();
            //getRadarMosaic();
        }
    });
    $('input[name="channelCheckBoxes"]').click(function(){
        refreshChannelBtns();
    });
    
    refreshChannelBtns();
    

    $('.default-mode').click(function(){
        var $this = $(this);
        var $textarea = $this.parent().parent().siblings('textarea');
        if(this.checked){
            $textarea.prop('disabled', true);
            $textarea.addClass('gray');
        } else {
            $textarea.prop('disabled', false);
            $textarea.removeClass('gray');
        }
    });
});

function refreshChannelBtns(){
    var $showList = $('input[name="channelCheckBoxes"]:checked');
    var $allCheckboxes = $('input[name="channelCheckBoxes"]');
    var $btns = $('.channelContentBtnSel').hide().removeClass('channelContentSel-selected');
    $btns.hide();
    var $textAreas = $('.channelContentSel').hide(300);
    $(".textarea-wrapper").hide();
    $.each($showList, function(i,l){
        var $this =$(l);
        var index = $allCheckboxes.index($this);
        if(index>=0)
            $btns.eq(index).show();
    });
    
     $(".channelContentBtnSel").click(function(){
        var $currentDom = $(this);
        
        $(".channelContentBtnSel").removeClass('channelContentSel-selected');
        var index = $(".channelContentBtnSel").index($currentDom);
        var $textArea = $(".channelContentSel").eq(index);
        var $divWrapper = $(".textarea-wrapper").eq(index);
        $(".channelContentSel").hide();
        $(".textarea-wrapper").hide();
        
        $divWrapper.show(50);
        $textArea.show(50);
        $currentDom.addClass('channelContentSel-selected');
        /*
        if($(".channelContentSel").eq(index).val()=='') {
            var contentText = "请输入公告内容";
            $(".channelContentSel").eq(index).val(contentText);
            $("#content").val($(".channelContentSel").eq(index).html());
        }
        */
    });
     var tx2 = $showList.length;
     if(tx2>0){
          var index = $allCheckboxes.index($showList.eq(0));
          $btns.eq(index).trigger("click");
     }
}
 $('document').ready(function(){
		 ach();
		 $("#limitWord").trigger("keyup");
        refreshCheckBoxState();
        $('.checkbox_style input[type="checkbox"]').click(function(){
            refreshCheckBoxState();
        });
        
        $('.select-all-selector1').click(function(){
            var isChecked = $(this).prop('checked');
           
            var $checkboxWrapper = $('.choose_area');
            $checkboxWrapper.find('.checkbox_style input[type="checkbox"]').prop('checked', isChecked);
            refreshCheckBoxState();
        });
        $('textArea.channelContentSel').keyup(function(){
            var $this = $(this);
            var maxLengthStr = $this.attr('data-length');
            var maxLength = parseInt(maxLengthStr);
            var text = $this.val();
            if(text.length>maxLength){
                text = text.substr(0, maxLength);
                $this.val(text);
            }
            var Remaining='还可以输入'+(maxLength-text.length).toString()+'字';
            $this.siblings('.text-left-words').html(Remaining);
        });
        $('textArea.channelContentSel').trigger("keyup"); 
});
    
    function refreshCheckBoxState() {
        $('.checkbox_style input[type="checkbox"]:checked').parent('div .checkbox_style').addClass('checkbox_styles');
        $('.checkbox_style input[type="checkbox"]:not(:checked)').parent('div .checkbox_style').removeClass('checkbox_styles');
    }
    function ach(){
        $("#imgClick").click(function(){
            var imagePathT = $(this).attr("src");
            window.open(imagePathT);
        });
        /*限制字数*/
        $("#limitWord").keyup(function(){
            var curLength=$("#limitWord").val().length;    
            if(curLength>=200){
                var num=$("#limitWord").val().substr(0,200);
                $("#limitWord").val(num);
                $("#textCount").text(0);
                $(".channelContentSel").val(num);
            }
            else{
                $("#textCount").text(200-$("#limitWord").val().length);
                var num=$("#limitWord").val();
                $(".channelContentSel").val(num);
            }
        });
    }
    function FileUpload() {
    	var filepath = $("#file").val();
        var extStart=filepath.lastIndexOf(".");
        var ext=filepath.substring(extStart,filepath.length).toUpperCase();
        if(ext!=".BMP"&&ext!=".PNG"&&ext!=".GIF"&&ext!=".JPG"&&ext!=".JPEG"){
            alert("图片限于bmp,png,gif,jpeg,jpg格式");
            return false;
        }else{
        	 $.ajaxFileUpload({
                 url : '${base}/sev/alarm/uploadPage',// 用于文件上传的服务器端请求地址
                 dataType : "json",
                 secureuri : false,// 一般设置为false
                 fileElementId : 'file',// 文件上传空间的id属性 
                 error : function(data) {
                     alert("请选择文件上传");
                 },
                 success : function(data) {
                     $("#imagePath").val(data.data);
                     $(".m-text-textarea.dpi").empty();
                     var ddiv = "<img src='/upload/"+data.data+"' id='imgClick' style ='height:99px;cursor:pointer;)'/>";
                     $(".m-text-textarea.dpi").append(ddiv);
                     ach();
                 }
             });
        }
   }
</script>