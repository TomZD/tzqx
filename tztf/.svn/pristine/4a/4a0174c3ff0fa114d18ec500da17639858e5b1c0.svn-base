<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="author" content="grassinfo"/>
    <title>黄岩公共突发事件预警发布平台-发布责任单位-预警发布-填写发布申请</title>
    <link rel="stylesheet" href="/static/css/global.css">
    <link rel="stylesheet" href="/static/css/publishApplication.css">
    <!--日历控件开始-->
    <link rel="stylesheet" href="/static/js/datepicker/css/jqueryui.min.css">
    <link rel="stylesheet" href="/static/js/datepicker/css/jquery-ui-timepicker-addon.css">
    <link rel="stylesheet" href="/static/js/datepicker/css/timepick.css">
    <!--日历控件结束-->
     <style>
     body{
         background: url(/static/images/bg_img.png) no-repeat;
             background-size: 100% 100%;
     }
     .popup_bd{
			max-height:330px;
			overflow-x: auto;
		}
        .checkbox_style input{
            float: left;
           /* width: 10px !important;*/
            width: 0px !important;
            height: 10px !important;
            padding: 0px !important;
            margin: 0px !important;
        }
       .typeColor,.reviewer,.issuer{
            width: 229px;
            height: 32px;
            color: #bebed8;
       } 
       .type{
            width: 229px;
            height: 32px;
            color: #bebed8;
       } 
       .publishForm{
            width: 172px;
            height: 35px;
            line-height: 35px;
            color: #FFF;
            text-align: center;
            background: #0f8ffe;
            border-radius: 3px;
            margin-right: 12px;
            display: inline-block;
        }
        .g-bd-left-con ul li .m-checkbox span{
            text-align: left;
            width:80px;
            margin-left:12px;
        }
            .channelContentSel{
               width:92%;
                border: 1px solid rgba(190, 190, 216, 0.2);
                background: rgba(0, 0, 0, 0.1);
                line-height: 34px;
                padding: 0 15px;
                border-radius: 4px;
            }
        .file {
            position: relative;
            display: inline-block;
            background: #D0EEFF;
            border: 1px solid #99D3F5;
            border-radius: 4px;
            padding: 7px 15px;
            overflow: hidden;
            color: #1E88C7;
            text-decoration: none;
            text-indent: 0;
            line-height: 20px;
            margin-right:20px;
        }
        .file input {
            position: absolute;
            font-size: 100px;
            right: 0;
            top: 0;
            opacity: 0;
        }
        .file:hover {
            background: #AADFFD;
            border-color: #78C3F3;
            color: #004974;
            text-decoration: none;
        }
        .m-select select.m-text-input,.m-select .m-text-input-text {
            border: 1px solid rgba(190,190,216,0.2);
            border-radius: 5px;
            height: 32px;
            background: rgba(0,0,0,0.1);
        }
        .m-select .m-text-input-text{
            padding:0 15px;
            margin-right:5px;
        }
        .checkboxAreaAll,.checkboxChannelAll{
            width: 16px;
            height: 16px;
            float: left;
            cursor: pointer;
            margin-top: 10px;
            text-align: center;
            background-image: url(/static/images/oncheck_img.png);
            background-repeat: no-repeat;
        }
        .m-button{
            margin-top:0px;
        }
        .query_hd li{
            margin-bottom: 5px;
        }
        .m-button-bottom{
            position: relative;
            bottom: -20px;
            margin-bottom: 20px;
            float: left;
        }
        .bubble-box {
            bottom: -94%;
        }
        .bubble-box .m-arrow{
            bottom: 60px;
        }
        .m-select select option{
            background:rgba(0, 0, 0, 0.8);
            color: #FFF;
        }
        .m-text-textarea{
            height:140px;
        }
        .m-poplayer-table tr td{
            text-align: left;
            line-height: 25px;
            text-overflow: initial;
            white-space: normal;
        }
        .m-poplayer-table tr:first-child td:first-child{
            width: 16%;
        }
        .popup_bd{
            max-height:330px;
            overflow-x: auto;
        }
        .query_hd li:hover, .query_hd li.channelContentSel-selected {
            border: 2px solid #4a85f2;
        }
        .m-button-bottom a {
            width: 140px;
            height: 35px;
            line-height: 35px;
            text-align: center;
            display: inline-block;
            border-radius: 3px;
        }
         a.abandon {
            background: rgba(99,99,99,0.21);
            color: #9d9dd3;
         }
          .m-text-input{
          height:34px;
          }
          .m-text-textarea{
		        min-height:70px;
		        overflow-y:auto;
		        overflow-x:hidden;
	        }
	        .g-bd-right.form_right{
	            position: relative;
	        }
	        .g-bd-right-modular{
	            top: 0;
                bottom: 0;
	            position: absolute;
	        }
	        .channelContentSel{
                min-height:102px;
                overflow-y:auto;
                overflow-x:hidden;
            }
    </style>
</head>
<body>
     <!--弹窗开始-->
    <div class="m-poplayer">
        <div class="popup_con"></div>
    </div>
    <!--弹窗结束-->
    <!--时间轴开始-->
    <div class="m-event mb10">
        <div class="m-event-schedule">
            <div class="m-event-timeAxis">
                <!--事件进度时间轴底部开始-->
                <div class="m-timeAxis-bg">
                    <dl>
                        <dd></dd>
                    </dl>
                   
                    <dl>
                        <dd></dd>
                    </dl>
                    <dl>
                        <dd></dd>
                    </dl>
                </div>
                <!--事件进度时间轴底部结束-->
                <!--事件进度时间轴进度开始-->
                <div class="m-timeAxis-con">
                    <dl>
                        <dd><i></i></dd>
                    </dl>
                </div>
                <!--事件进度时间轴进度结束-->
            </div> 
            <!--事件进度说明开始-->
            <li class="m-event-explain">
                <p><span>$!{departmentName}申请发布</span>
                
                <span>发布平台执行</span>
                <span>发布完成</span></p>
            </li>
            <!--事件进度说明开始-->
        </div>   
    </div>                          
    <!--时间轴结束-->
<form action="" method="post" id="form" name="form">
<input type = "hidden" id="imagePath" name = "imagePath" value="">
<input type = "hidden" id="alarmTypeName" name = "alarmTypeName" value="">
<input type = "hidden" id="typeT" name = "type" value="$!{alarmName}">
<input type = "hidden" id="typeId" name = "typeId" value="">
    <!--内容开始-->
    <div class="g-bd-cont">
        <!--标题开始-->
        <div class="g-bd-tit">
            <span>$!{departmentName}发布申请</span><span class="filenum"></span>
        </div>
        <!--标题结束-->
        <!--左边开始-->
        <div class="g-bd-left">
            <!--内容开始-->
            <div class="g-bd-left-con">
                <ul>
                    <!--标题开始-->
                    <li><span>标题</span><input type="text" id="title" name="title" class="m-text-input" value="$!{name}" /></li>
                    <!--标题结束-->
                </ul>
                
                #if($alarmName =="alarm")
                <!--预警部分  -->
                <ul class="m-sets">
                    <!--信息类别开始-->
                    <li>
                        <span>信息类别</span>
                        <div class="m-select">
                                <select id="type" class="type m-text-input" name="type">
                                 #foreach($alarmName in ${alarmTypeName})  
                                     <option value="$!{alarmName.namecn}">$!{alarmName.namecn}</option>   
                                 #end 
                                </select>
                        </div>
                    </li>
                    <!--信息类别结束-->
                    <!--预警级别开始-->
                    <li class="pl10">
                        <span>预警级别</span>
                        <div class="m-select">
                            <select id="typeColor" class="typeColor m-text-input" name="level">
                            </select>
                        </div>
                    </li>
                    <!--预警级别结束-->
                </ul>
                 <!--预警部分  -->
                 #elseif($!alarmName == "event") 
                 <!--事件部分  -->
                <ul class="m-sets">
                    <!--信息类别开始-->
                    <li>
                        <span>信息类别</span>
                        <div class="m-select">
                                <select id="type" class="type m-text-input" name="typeT">
                                 #foreach($eventName in ${eventType})  
                                     <option value="$!{eventName.displayName}">$!{eventName.displayName}</option>   
                                 #end 
                                </select>
                        </div>
                    </li>
                    <!--信息类别结束-->
                    <!--预警级别开始-->
                    <li class="pl10">
                        <span>预警级别</span>
                        <div class="m-select">
                            <select id="typeColor" class="typeColor m-text-input" name="level">
                                <option value="蓝色">蓝色</option>
                                <option value="黄色">黄色</option>
                                <option value="橙色">橙色</option>
                                <option value="红色">红色</option>
                            </select>
                        </div>
                    </li>
                    <!--预警级别结束-->
                </ul>
                 <!--事件部分  -->
                 #end
                 
                <ul class="m-sets">
                    <!--发布时间开始-->
                    <li><span>发布时间</span><input class="inputTimepick m-text-input" type="text" name="pubDate" id="basic_example_1" value=""></li>
                    <!--发布时间结束-->
                    <!--发布时效开始-->
                    <li class="pl10">
                        <span>发布时效</span>
                        <div class="m-select">
                           <input type="text" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" id="prescription" name="duration" value="" autocomplete="off" class="m-text-input-text">小时
                        </div>
                    </li>
                    <!--发布时效结束-->
                </ul>
                <ul>
                    <!--发布范围开始-->
                    <li>
                        <span class="fl">发布范围</span>
                        <div class="checkbox_bd">
                            <div class="m-checkbox">
                                <input name="checkboxAreaAll" type="checkbox" class="radioclass" value="">
                                <i class="checkboxAreaAll"></i>
                                <span>全选</span>
                            </div>
                            #foreach($area in ${areaAll})  
                       
                            <div class="m-checkbox checkboxArea">
                                <input name="pubRangeName" type="checkbox" class="radioclass" value="$!area.country">
                                <i class="checkbox" data-id="$!area.abb"></i>
                                <span class="checkCountry" style="CURSOR: pointer;">$!area.country</span>
                            </div>
                             #end 
                        </div>
                    </li>
                    <!--发布范围结束-->
                </ul>
                
                #foreach($areaAll in ${areaAll})  
                  <ul style="display:none" id="$!areaAll.abb" name="countryUl">
                    <!--发布范围开始-->
                    <li>
                        <span class="fl">乡镇范围</span>
                        <div class="checkbox_bd">
                            <div class="m-checkbox">
                                <input name="checkboxAreaAll" type="checkbox" class="radioclass" value="">
                                <i class="checkboxAreaAll" data-id="$!areaAll.abb"></i>
                                <span>全选</span>
                            </div>
                            #foreach($area in ${areaAllTown})  
                                #if($!area.country == $!areaAll.country)
                                <div class="m-checkbox checkboxArea">
                                    <input name="pubRangeNameTown" type="checkbox" class="radioclass $!areaAll.abb" value="$!{area.town}" #if($pubRangeTown.indexOf($!area.town)>-1) checked="true" #end>
                                    <i class="checkbox #if( $pubRangeTown.indexOf($!area.town) >-1) on_check #end"></i>
                                    <span>$!{area.town}</span>
                                </div>
                                #end
                             #end 
                        </div>
                    </li>
                    <!--发布范围结束-->
                 </ul>
                #end 
                
                <ul>
                    <!--发布渠道开始-->
                    <li>
                        <span class="fl">发布渠道</span>
                        <div class="checkbox_bd">
                        
                            <div class="m-checkbox">
                                <input name="checkboxAreaAll" type="checkbox" class="radioclass" value="">
                                <i class="checkboxChannelAll"></i>
                                <span>全选</span>
                            </div>
                             #foreach($rc in ${releaseChannel}) 
                             <div class="m-checkbox checkbox_style">
                                <input name="channelCheckBoxes" type="checkbox" class="radioclass" value="channel_$!rc.nameEn">
                                <i class="checkbox"></i>
                                <span>$!rc.name</span>
                            </div> 
                             #end 
                        
                        </div>
                    </li>
                    <!--发布渠道结束-->
                </ul>
                
                 <!--标题位置开始-->
                
                 <!--标题位置结束-->
                
                <ul>
                    <!--发布内容开始-->
                    <li>
                        <span class="fl">发布内容</span>
                        <textarea class="m-text-textarea" name="content" id="limitWord"></textarea>
                        <p>限制200字,还剩<span id="textCount">0</span>字</p>
                    </li>
                    <!--发布内容结束-->
                </ul>                
                <ul class="m-sets-sets">
                    <!--操作人员开始-->
                    <li>
                        <span>操作人员</span>
                        <div class="m-select">
                           <input type="text" value="" name="publisher" class="m-text-input-text" style="width: 273px;">
                        </div>
                    </li>
                    <!--审稿人员结束-->                    
                    <!--发布时效开始-->
                    <li class="pl10">
                        <span>签发领导</span>
                        <div class="m-select">
                           <input type="text" id="issuer" name="issuer" value="" class="m-text-input-text" style="width: 273px;">
                        </div>
                    </li>
                    <!--签发人员结束-->
                </ul>       
            </div>
            <!--内容结束-->
        </div>
    <!--左边结束-->

    <!--右边开始-->
        <div class="g-bd-right form_right"> 
            <!--渠道总汇开始-->       
            <div class="g-bd-right-modular" style="position: absolute;">
                <!--标题开始-->
                <div class="g-bd-tit" style="border-bottom:none">
                    <span>发布预览</span>
                    <!--切换开始-->
                    <ul class="query_hd fr">
                         #foreach($rc in ${releaseChannel})  
                            <li class="channelContentBtnSel">${rc.name}</li>
                         #end 
                    </ul>
                    <!--切换结束-->
                </div>
                <!--标题结束-->
                <!--内容开始-->   
                #foreach($rc in ${releaseChannel})  
                   <div class="textarea-wrapper" style="clear:both;margin-bottom:5px">
                        <textarea class="channelContentSel" data-length="$!rc.maxLength" name="channel_$!rc.nameEn" style="height: 100px;" placeholder="请输入$!rc.name发布内容">$!rc.content</textarea>
                        <div class="text-left-words">还可以输入$!rc.maxLength字</div>
                    </div>
                 #end 
                <!--内容结束-->
                <!--按钮1开始-->                
                <div class="m-button">
                    <a id="publishForm" class="publishForm" style="cursor:pointer">生成申请表单</a>
                    <a href="javascript:;" class="file" style="top:13px;">领导签字后上传预览
                            <input type="file" name="file" id="file" onChange="FileUpload()">
                        </a>
                </div>
                <!--按钮1结束-->
                 <ul style="width: 100%; margin-top:20px;float:left">
                    <!--审批单开始-->
                    <li>
                        <span class="fl" style="line-height: 30px; text-indent: 0.8em;">审批单</span>
                        <div class="m-text-textarea dpi" style="width:92%"><h3>未上传</h3></div>
                    </li>
                    <!--发布内容结束-->
                </ul>
                #if($alarmName =="alarm")
                <!-- 防御措施 -->
                <ul style="width: 100%; margin-top:20px;float:left">
                    <!--审批单开始-->
                    <li>
                        <span class="fl" style="line-height: 30px; text-indent: 0.8em;">信号含义</span>
                        <textarea class="m-text-textarea" name="" readOnly="readonly" id="defence" style="width:92%;"></textarea>
                    </li>
                    <!--发布内容结束-->
                </ul>
                <!-- 防御措施 -->
                #end
                <!--按钮2开始-->                
                <div class="m-button-bottom">
                     #if($alarmName =="alarm")
                        <button class="report">一键式发布</button>
                     #end
                     #if($alarmName =="event")
                        <button class="report">上报发布中心</button>
                     #end
                    
                </div>
                <!--按钮2结束-->
            </div>
            <!--渠道总汇开始-->  
        </div>
    <!--右边结束-->
    </div>
    <!--内容开始-->
</form>   
    
    <!--js开始-->
    <script type="text/javascript" src="/static/js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="/static/js/public.js"></script>
    <!-- <script type="text/javascript" src="/static/js/publishApplication.js"></script> 
     <script type="text/javascript" src="/static/js/fillInTheApplicationExternal.js"></script>-->
     <script type="text/javascript" src="/static/js/application.js"></script>
     <script type="text/javascript" src="/static/js/ajaxfileupload.js"></script>
    <!--日历开始-->    
    <script type="text/javascript" src="/static/js/datepicker/js/jquery-ui.js"></script>
    <script type="text/javascript" src="/static/js/datepicker/js/jquery-ui-sliderAccess.js"></script>
    <script type="text/javascript" src="/static/js/datepicker/js/jquery-ui-timepicker-addon.js"></script>
    <script type="text/javascript" src="/static/js/datepicker/js/jquery-ui-timepicker-zh-CN.js"></script>
    <script type="text/javascript" src="/static/js/datepicker/js/useDatepick.js"></script>
    <!--日历结束-->  
    <!--js开始-->
</body>
</html>

<!-- 公用自写 -->
<script type="text/javascript">
var colorLevel = {
        "红色": "(I级/特别重大)",
        "橙色": "(II级/严重)",
        "黄色": "(III级/较重)",
        "蓝色": "(IV级/一般)",
    };
$('document').ready(function(){
    $("#reviewer").find("option").eq(0).prop("selected",true);
    $("#issuer").find("option").eq(0).prop("selected",true);
    
    $('textArea.channelContentSel').keyup(function(){
        var $this = $(this);
        var maxLengthStr = $this.attr('data-length');
        var maxLength = parseInt(maxLengthStr);
        var text = $this.val();
        if(text.length>maxLength){
            text = text.substr(0, maxLength);
            $this.val(text);
        }
        var Remaining='还可以输入'+(maxLength-text.length).toString()+'字';
        $this.siblings('.text-left-words').html(Remaining);
    });
    
    //生成发布表单
    $("#publishForm").click(function(){
        $.ajax({
            cache: true,
            type: "POST",
            url:"${base}/sev/alarm/createForm",
            data:$('#form').serialize(),// 你的formid
            async: false,
            error: function(request) {
                alert("Connection error");
            },
            success: function(data) {
                window.location.href="${base}/sev/alarm/download?data="+data;
            }
        });
    });
});
</script>

<!-- 事件部分 -->
#if($!alarmName =="event")
<script type="text/javascript">
var allEventType = #if($!allEventType.length!=0) $!allEventType #else {} #end  ;
$('document').ready(function(){
    $("#type").find("option").eq(0).prop("selected",true);
    $("#typeColor").find("option").eq(0).prop("selected",true);
    var eventTy = $('#type option:selected').text();
    for(var i=0;i<allEventType.length;i++){
        var info = allEventType[i];
        if(info.displayName == eventTy){
             $("#typeId").val(info.id);
        }
    }
    var eventType = $('#type option:selected').text();
    var color = $('#typeColor option:selected').text();
    $("#alarmTypeName").val(eventType+color);
    var Level = "";
    for(var key in colorLevel){
        if(key === color){
            level = colorLevel[key];
        }
    }
    var text = "$!{departmentName}发布的"+eventType+color+"预警"+level;
    $("#title").val(text);
    var appContent = "$!{departmentName}"+$("#basic_example_1").val()+"发布"+eventType+color+"预警：";
    $("#limitWord").val(appContent);
    $('.channelContentSel').val(appContent);
    
    $("#typeColor").click(function(){
        var eventType = $('#type option:selected').text();
        var color = $('#typeColor option:selected').text();
        $("#alarmTypeName").val(eventType+color);
        var Level = "";
        for(var key in colorLevel){
            if(key === color){
                level = colorLevel[key];
            }
        }
        var text = "$!{departmentName}发布的"+eventType+color+"预警"+level;
        $("#title").val(text);
        var appContent = "$!{departmentName}"+$("#basic_example_1").val()+"发布"+eventType+color+"预警：";
        $("#limitWord").val(appContent);
        $('.channelContentSel').val(appContent);
        
    });
    $("#type").click(function(){
        var eventType = $('#type option:selected').text();
        var color = $('#typeColor option:selected').text();
        $("#alarmTypeName").val(eventType+color);
        var Level = "";
        for(var key in colorLevel){
            if(key === color){
                level = colorLevel[key];
            }
        }
        for(var i=0;i<allEventType.length;i++){
            var info = allEventType[i];
            if(info.displayName == eventType){
                 $("#typeId").val(info.id);
            }
        }
        var text = "$!{departmentName}发布的"+eventType+color+"预警"+level;
        $("#title").val(text);
        $("#typeColor").find("option").eq(0).prop("selected",true);
        $("#typeColor").trigger("click");
    });
});
</script>
#end
<!-- 事件部分 -->

<!-- 预警部分 -->
#if($!alarmName =="alarm")

<script type="text/javascript">
    var allAlarmType = #if($!alarmType.length!=0) $!alarmType #else {} #end  ;
    var myArray=new Array();
    $('document').ready(function(){
        //页面加载获取
        var typeL ="$!{typeL}";
         $("#type").find("option[value='"+typeL+"']").attr("selected",true);
         var typeData = $("#type").val();
         var typeColorData = "";
         for(var i=0;i<allAlarmType.length;i++){
             var info = allAlarmType[i];
             if(info.namecn == typeData){
                 var typeName = info.caption;
                 var colorName = typeName.substring(typeName.length-2,typeName.length);
                 typeColorData += "<option value="+typeName+">"+colorName+"</option>";  
             }
         }
         $("#typeColor").empty();
         $("#typeColor").append(typeColorData);
         var type = $('#typeColor option:selected').val();
         var color = $('#typeColor option:selected').text();
         var Level = "";
         for(var key in colorLevel){
             if(key === color){
                 level = colorLevel[key];
             }
         }
         var text = "杭州市气象台发布的"+type+"预警"+level;
         $("#title").val(text);
         for(var j=0;j<allAlarmType.length;j++){
             var info = allAlarmType[j];
             if(info.caption == type){
                 $("#typeId").val(info.id);
                 var time = info.validity;
                 $("#prescription").val(time);
                 var appContent = "$!{departmentName}"+$("#basic_example_1").val()+"发布"+type+"预警：";
                 //新增防御措施
                 var defence=info.content;
                 $("#defence").val(defence);
                 $("#limitWord").val(appContent);
                 $('.channelContentSel').val(appContent);
             }
         }
        $("#alarmTypeName").val(type);
       
        
        $("#typeColor").click(function(){
            var type = $('#typeColor option:selected').val();
            var color = $('#typeColor option:selected').text();
            $("#alarmTypeName").val(type);
            var Level = "";
            for(var key in colorLevel){
                if(key === color){
                    level = colorLevel[key];
                }
            }
            var text = "$!{departmentName}发布的"+type+"预警"+level;
            $("#title").val(text);
            for(var i=0;i<allAlarmType.length;i++){
                var info = allAlarmType[i];
                if(info.caption == type){
                    var time = info.validity;
                    $("#typeId").val(info.id);
                    $("#prescription").val(time);
                    var appContent = "$!{departmentName}"+$("#basic_example_1").val()+"发布"+type+"预警：";
                    //9.13新增防御措施
                    var defence=info.content;
                    $("#defence").val(defence);
                    $("#limitWord").val(appContent);
                    $('.channelContentSel').val(appContent);
                    
                }
            }
            
        })
        $("#type").click(function(){
            var typeData = $("#type").val();
            var typeColorData = "";
            for(var i=0;i<allAlarmType.length;i++){
                var info = allAlarmType[i];
                if(info.namecn == typeData){
                    var typeName = info.caption;
                    var colorName = typeName.substring(typeName.length-2,typeName.length);
                    typeColorData += "<option value="+typeName+">"+colorName+"</option>";  
                }
            }
            $("#typeColor").empty();
            $("#typeColor").append(typeColorData);
            $("#typeColor").find("option").eq(0).prop("selected",true);
            $("#typeColor").trigger("click");
        })
        
      //2017.12.01jinb新增
        var nedColor ="$!{nameLevel}";
        $("#typeColor").find("option[value='"+nedColor+"']").prop("selected",true);
        $("#typeColor").trigger("click");
    });
</script>
#end
<!-- 预警部分 -->

<!-- 公用 -->
<script type="text/javascript">
$('document').ready(function(){
    $(".checkCountry").click(function(){
        var a=$(this).parent().find("i").attr("data-id");
        $(".checkCountry").removeClass("checkToTown");
        $(this).addClass("checkToTown");
        debugger;
        var $allcountry = $('ul[name="countryUl"]');
        $.each($allcountry, function(i,l){
            if($(l).attr("id")==a){
                $(l).show();
            }else{
                $(l).hide();
            }
        });
    });
    /* checkbox*/
    var $allcountry = $('ul[name="countryUl"]');
    $.each($allcountry, function(i,l){
        var dataId = $(l).attr("id");
        if($('.checkboxArea .'+dataId+':checked').length==$('.checkboxArea .'+dataId+'').length ){
            $(l).find(".checkboxAreaAll").addClass("on_check");
            $(l).find(".checkboxAreaAll").parent().find(".radioclass").prop("checked", true);
        }
        if($('.checkboxArea .'+dataId+':checked').length>0){
            $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".radioclass").prop("checked", true);
            $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".checkbox").addClass("on_check");
        }
   });
    if($('.checkboxArea input[name="pubRangeName"]:checked').length==$('.checkboxArea input[name="pubRangeName"]').length ){
        $(".checkCountry").parents(".checkbox_bd").find(".checkboxAreaAll").addClass("on_check");
        $(".checkCountry").parents(".checkbox_bd").find(".checkboxAreaAll").parent().find(".radioclass").prop("checked", true);
        
    }
    
    
     /*复选框选中全选区县*/
    $(".checkboxAreaAll").on("click", function () {
        debugger;
        $(this).toggleClass("on_check");
        // 获取父节点是否选中-2017-09-04-倪佳慧-修改
        if($(this).is('.on_check')){
             $(this).parent().find("input.radioclass").prop("checked","true");
        }else{
             $(this).parent().find("input.radioclass").removeAttr("checked");
        }
        var isChange = $(this).parent().find(".radioclass").prop("checked");
        var dataId = $(this).attr("data-id");
        if(isChange){ // 如果选中,则父节点下的所有的子节点都选中
          // 获取当前checkbox节点的兄弟节点下的所有的checkbox子节点选中
          $(this).parents(".checkbox_bd").find(".checkboxArea").find(".radioclass").prop("checked", true);
          $(this).parents(".checkbox_bd").find(".checkboxArea").find(".checkbox").addClass("on_check");
          if(dataId !=undefined){
              $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".radioclass").prop("checked", true);
              $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".checkbox").addClass("on_check");
              //$('.checkbox[data-id="'+dataId+'"]').trigger("click");
          }else{
            //  $(".checkbox").addClass("on_check");
             // $(".checkboxAreaAll").addClass("on_check");
            //  $(".radioclass").prop("checked", true);
              $(".checkboxAreaAll").parents(".checkbox_bd").find(".radioclass").prop("checked", true);
              $(".checkboxAreaAll").parents(".checkbox_bd").find(".checkbox").addClass("on_check");
              $(".checkboxAreaAll").addClass("on_check");
              $('ul[name="countryUl"]').hide();
          }
        }else{ // 未选中，取消全选
          // 获取当前checkbox节点的兄弟节点下的所有的checkbox子节点选中
              $(this).parents(".checkbox_bd").find(".checkboxArea").find(".radioclass").removeAttr("checked");
              $(this).parents(".checkbox_bd").find(".checkboxArea").find(".checkbox").removeClass("on_check");
              $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".radioclass").prop("checked", false);
              $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".checkbox").removeClass("on_check");
              if(dataId !=undefined){
                  $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".radioclass").prop("checked", false);
                  $('.checkbox[data-id="'+dataId+'"]').parents(".m-checkbox.checkboxArea").find(".checkbox").removeClass("on_check");
                  //$('.checkbox[data-id="'+dataId+'"]').trigger("click");
              }else{
                  $(".checkboxAreaAll").parents(".checkbox_bd").find(".radioclass").prop("checked", false);
                  $(".checkboxAreaAll").parents(".checkbox_bd").find(".checkbox").removeClass("on_check");
                  $(".checkboxAreaAll").removeClass("on_check");
                  $('ul[name="countryUl"]').hide();
              }
        }
        //jinb
       
       
    })
    

        /*复选框选中全选渠道*/
    $(".checkboxChannelAll").on("click", function () {
        $(this).toggleClass("on_check");
        // 获取父节点是否选中-2017-09-04-倪佳慧-修改
        
        if($(this).is('.on_check')){
             $(this).parent().find("input.radioclass").prop("checked","true");
             refreshChannelBtns();
             $('.textarea-wrapper').show();
        }else{
             $(this).parent().find("input.radioclass").removeAttr("checked");
        }
        var isChange = $(this).parent().find(".radioclass").prop("checked");
        
        if(isChange){ // 如果选中,则父节点下的所有的子节点都选中
          // 获取当前checkbox节点的兄弟节点下的所有的checkbox子节点选中
          $(this).parents(".checkbox_bd").find(".checkbox_style").find(".radioclass").prop("checked", true);
          $(this).parents(".checkbox_bd").find(".checkbox_style").find(".checkbox").addClass("on_check");
          refreshChannelBtns();
        }else{ // 未选中，取消全选
          // 获取当前checkbox节点的兄弟节点下的所有的checkbox子节点选中
          $(this).parents(".checkbox_bd").find(".checkbox_style").find(".radioclass").removeAttr("checked");
          $(this).parents(".checkbox_bd").find(".checkbox_style").find(".checkbox").removeClass("on_check");
          refreshChannelBtns();
        }
        });
    /*日历加载*/
    $('#basic_example_1').datetimepicker({//时间格式化
        timeFormat: "HH:mm",
        dateFormat: "yy-mm-dd",
        showMonthAfterYear: false,
        changeMonth: true,
        changeYear: true,
        yearRange: "1990:2050",
        setColorstyle: false,
        maxDate: new Date().format("yyyy-MM-dd HH:mm"),
        //maxDate: new Date($('#basic_example_1').val() + ":00").format("yyyy-MM-dd"),
        Colorstyle: { "topColor": "#900", "bodyColor": "#000", "activeColor": "#900", "sliderColor": "#900", "hoverColor": "#900" },//定义外观颜色
        onSelect: function () {//选择日期后执行的操作  
             var type = $('#type option:selected').val();
             var color = $('#typeColor option:selected').text();
             var appContent = "$!{departmentName}"+$("#basic_example_1").val()+"发布"+type+color+"预警："; 
             var txt1 = $("#limitWord").val();
             var index1 = txt1.indexOf("：");
             var subTxt = txt1.substring(0,index1+1);
             txt1 = txt1.replace(subTxt,appContent);
             $("#limitWord").val(txt1);
             $("#limitWord").trigger("keyup");
            //getTimeList();
            //getRadarMosaic();
        }
    });
    $('input[name="channelCheckBoxes"]').click(function(){
        var display =$('.textarea-wrapper').css('display');
        if(display == 'none'){
            $('.textarea-wrapper').show();
            refreshChannelBtns();
        }else{
            $('.textarea-wrapper').hide();
        }
    });
    
    refreshChannelBtns();
    
    $(".textarea-wrapper").hide();

    $('.default-mode').click(function(){
        var $this = $(this);
        var $textarea = $this.parent().parent().siblings('textarea');
        if(this.checked){
            $textarea.prop('disabled', true);
            $textarea.addClass('gray');
        } else {
            $textarea.prop('disabled', false);
            $textarea.removeClass('gray');
        }
    });
});

function refreshChannelBtns(){
    var $showList = $('input[name="channelCheckBoxes"]:checked');
    var $allCheckboxes = $('input[name="channelCheckBoxes"]');
    var $btns = $('.channelContentBtnSel').hide().removeClass('channelContentSel-selected');
    $btns.hide();
    var $textAreas = $('.channelContentSel').hide(300);
    $(".textarea-wrapper").hide();
    $.each($showList, function(i,l){
        var $this =$(l);
        var index = $allCheckboxes.index($this);
        if(index>=0)
            $btns.eq(index).show();
    });
    
     $(".channelContentBtnSel").click(function(){
        var $currentDom = $(this);
        
        $(".channelContentBtnSel").removeClass('channelContentSel-selected');
        var index = $(".channelContentBtnSel").index($currentDom);
        var $textArea = $(".channelContentSel").eq(index);
        var $divWrapper = $(".textarea-wrapper").eq(index);
        $(".channelContentSel").hide();
        $(".textarea-wrapper").hide();
        
        $divWrapper.show(50);
        $textArea.show(50);
        $currentDom.addClass('channelContentSel-selected');
        /*
        if($(".channelContentSel").eq(index).val()=='') {
            var contentText = "请输入公告内容";
            $(".channelContentSel").eq(index).val(contentText);
            $("#content").val($(".channelContentSel").eq(index).html());
        }
        */
    });
     var tx2 = $showList.length;
     if(tx2>0){
          var index = $allCheckboxes.index($showList.eq(0));
          $btns.eq(index).trigger("click");
     }
   
}
 $('document').ready(function(){
        ach();
        $("#limitWord").trigger("keyup");
        refreshCheckBoxState();
        $('.checkbox_style input[type="checkbox"]').click(function(){
            refreshCheckBoxState();
        });
        
        $('.select-all-selector1').click(function(){
            var isChecked = $(this).prop('checked');
           
            var $checkboxWrapper = $('.choose_area');
            $checkboxWrapper.find('.checkbox_style input[type="checkbox"]').prop('checked', isChecked);
            refreshCheckBoxState();
        });
        $('textArea.channelContentSel').trigger("keyup"); 
});
    
    function refreshCheckBoxState() {
        $('.checkbox_style input[type="checkbox"]:checked').parent('div .checkbox_style').addClass('checkbox_styles');
        $('.checkbox_style input[type="checkbox"]:not(:checked)').parent('div .checkbox_style').removeClass('checkbox_styles');
    }
    function ach(){
        $("#imgClick").click(function(){
            var imagePathT = $(this).attr("src");
            window.open(imagePathT);
        });
        /*限制字数*/
        $("#limitWord").keyup(function(){
            var curLength=$("#limitWord").val().length;    
            if(curLength>=200){
                var num=$("#limitWord").val().substr(0,200);
                $("#limitWord").val(num);
                $("#textCount").text(0);
                $(".channelContentSel").val(num);
            }
            else{
                $("#textCount").text(200-$("#limitWord").val().length);
                var num=$("#limitWord").val();
                $(".channelContentSel").val(num);
            }
            $('textArea.channelContentSel').trigger("keyup"); 
        });
    }
    function FileUpload() {
        var filepath = $("#file").val();
        var extStart=filepath.lastIndexOf(".");
        var ext=filepath.substring(extStart,filepath.length).toUpperCase();
        if(ext!=".BMP"&&ext!=".PNG"&&ext!=".GIF"&&ext!=".JPG"&&ext!=".JPEG"){
            $(".m-poplayer").fadeIn(200);
            _body = '<div class="popup_bd">'
                + '</div>'
                + '<div class="popup_bottom">'
//              + '<a href="javascript:void(0)" class="m-btn m-confirm">确定</a>'
                + '</div>';
            /*弹窗位置*/
            //发布弹窗在屏幕中间
            var leftWidth = ($(window).width() - 486) / 2; 
            $(".m-poplayer").find("div.popup_con").css("left", leftWidth).css("height", "50px").width(486).html(_body);
            /*添加popup_bd内容部分*/
            $(".m-poplayer").find("div.popup_bd").append("<ul><li class='publish'><span>图片限于bmp,png,gif,jpeg,jpg格式</span></li></ul>");
            $(".m-poplayer").find("div.popup_bd").find("li.publish").css("border-bottom", "none").css("line-height","25px").css("text-align","center");
            $(".m-poplayer").find("div.popup_bd").find(".m-text-textarea").css("margin-top","30px").css("width","66%");
            $(".m-poplayer").find("div.popup_bd").find("p.text").css("margin-left","45%");
            setTimeout(function () { 
               $(".m-poplayer").fadeOut(200);
            }, 1000);
            return false;
        }else{
            $.ajaxFileUpload({
                url : '${base}/sev/alarm/uploadPage',// 用于文件上传的服务器端请求地址
                dataType : "json",
                secureuri : false,// 一般设置为false
                fileElementId : 'file',// 文件上传空间的id属性 
                error : function(data) {
                    alert("请选择文件上传");
                },
                success : function(data) {
                    $("#imagePath").val(data.data);
                    $(".m-text-textarea.dpi").empty();
                    var ddiv = "<img src='/upload/"+data.data+"' id='imgClick' style ='height:99px;cursor:pointer;)'/>";
                    $(".m-text-textarea.dpi").append(ddiv);
                    ach();
                }
            });
        }
        
   }
    $(function(){
        
    //  $.ajax({
//          async : false,
//          type : "POST",
//          url : "/sev/check/getText",
//          data : {pubNo:pubNo},
//          dataType : "json",
//          success : function(d) {
//              var text ="";
//             for(var i=0;i<d.data.length;i++){
//                  var dataList = d.data[i];
//                  if(i%2==0){
//                      text += " <tr class=\"co1\"><td>"+dataList.channel+"</td><td>"+dataList.content+"</td><td><span>"+dataList.time+"</span><span>"+dataList.hour+"</span></td>"
//                             + "<td>递交完毕</td><td>100%</td><td><a class=\"details\">详情</a></td></tr>";
//                  }else{
//                      text += " <tr><td>"+dataList.channel+"</td><td>"+dataList.content+"</td><td><span>"+dataList.time+"</span><span>"+dataList.hour+"</span></td>"
//                        + "<td>递交完毕</td><td>100%</td><td><a class=\"details\">详情</a></td></tr>";
//                  }
//               }
//             $("#detail").html(text);
//          }
//             
    //  }); 
        window.onload = function(){ 
        /*左侧高度*/
        var _h = $(window).height();
        $(".g-bd-left").height(_h);
        /*右侧高度*/
        $(".g-bd-right").height(_h);
        $(".g-bd-right .h100").height(_h -$(".m-event").height() - 24);
        /*左侧内容每个格子宽度*/
        var ulWidth = $(".g-bd-left-cont").find("ul").width();
        $(".g-bd-left-cont ul li").width((ulWidth - 4) / 5);
    } 

        /*右侧时间轴每一格的位置*/
        var eventWidth= $(".m-event-schedule").width()-10;
        $(".m-event-timeAxis").width(eventWidth);
        $(".m-timeAxis-bg dl").width((eventWidth) / 3 );
        $(".m-timeAxis-con dl").width((eventWidth) / 3 );
        $(".m-event-schedule p span").width(eventWidth / 3 -3 );
        $(".g-bd-right-modular").find(".m-timeAxis-con").each(function(i){
            if($(this).find("dd").hasClass("alert")){
                var _index = $(this).find("dd.alert").parent().index();
                var conDlWidth = ($(this).find("dd.alert").parent().width() - 29) / 2;
                $(this).find("dd.alert").parent().width($(this).find("dd.alert").parent().width() / 2 + 10);
                var timeAxisWidth = eventWidth / 3 * (_index + 1) - conDlWidth;
                // $(this).width(timeAxisWidth);
                /*红点下面的文字也为红色*/
                $(this).parents(".m-event-timeAxis").next(".m-event-explain").find("span").eq(_index).css("color","#ff4747");
                /*判断红字是否换行，如果换行就加上一定的高度*/
                if($(this).parents(".m-event-timeAxis").next(".m-event-explain").find("span").eq(_index).height() > 22){
                    $(this).parents(".m-event-timeAxis").next(".m-event-explain").find("span").eq(_index).css("position","relative");
                    $(this).parents(".m-event-timeAxis").next(".m-event-explain").find("span").eq(_index).css("top","11px");
                }
            }else if($(this).find("dd").hasClass("finish")){
                var _index = $(this).find("dd.finish").parent().index();
                var conDlWidth = ($(this).find("dd.finish").parent().width() - 29) / 2;
                $(this).find("dd.finish").parent().width($(this).find("dd.finish").parent().width() / 2 + 10);
                var timeAxisWidth = eventWidth / 4 * (_index + 1) - conDlWidth;
                // $(this).width(timeAxisWidth);
                /*判断完成的说明是否换行，如果换行就加上一定的高度*/
                if($(this).parents(".m-event-timeAxis").next(".m-event-explain").find("span").eq(_index).height() > 22){
                    $(this).parents(".m-event-timeAxis").next(".m-event-explain").find("span").eq(_index).css("position","relative");
                    $(".g-bd-right-modular").css("position","absolute");
                    $(this).parents(".m-event-timeAxis").next(".m-event-explain").find("span").eq(_index).css("top","11px");
                }
            }
        });

    })
$(function(){
    /*填写发布申请时间轴*/
    var eventWidth= $(".m-event").width();
    var conDlWidth = ($(".m-timeAxis-con").find("dl").width() - 29) / 2;
    $(".m-timeAxis-con").find("dl").width($(".m-timeAxis-con").find("dl").width() / 2 + 10);
    var timeAxisWidth = eventWidth / 3 - conDlWidth;
    // $(".m-timeAxis-con").width(timeAxisWidth);
    $(".m-timeAxis-con").find("dd").css("margin-right","0");

    /*宽度计算*/
    $(".checkbox_bd").width($(".g-bd-left-con").width()-$(".g-bd-left-con ul li span").width() - 30);$(".checkbox_bd").width($(".g-bd-left-con").width()-$(".g-bd-left-con ul li span").width() - 35);

    $(".form_text").width($(".form_right").width() - 45);

    /*右侧切换*/
    var $li = $('.query_hd > li');
    var $ul = $('.form_text');


    function alertWin(data){
        $(".m-poplayer").fadeIn(200);
        var _body = '<div class="popup_bd">'
            + '</div>'
            + '<div class="popup_bottom">'
//            + '<a href="javascript:void(0)" class="m-btn m-confirm">确定</a>'
            + '</div>';
        /*弹窗位置*/
        //发布弹窗在屏幕中间
        var leftWidth = ($(window).width() - 486) / 2; 
        $(".m-poplayer").css("opacity",1);
        $(".m-poplayer").find("div.popup_con").css("left", leftWidth).css("height", "150px").width(486).html(_body);
        /*添加popup_bd内容部分*/
        $(".m-poplayer").find("div.popup_bd").append("<ul><li class='publish'><span>"+data+"</span></li></ul>");
        $(".m-poplayer").find("div.popup_bd").find("li.publish").css("border-bottom", "none").css("line-height","25px").css("text-align","center");
        $(".m-poplayer").find("div.popup_bd").find(".m-text-textarea").css("margin-top","30px").css("width","66%");
        $(".m-poplayer").find("div.popup_bd").find("p.text").css("margin-left","45%");
//        $(".m-btn.m-confirm").on("click", function () {
//           
//        });
        setTimeout(function () { 
         $(".m-poplayer").fadeOut(200);
        }, 1000);
        
    }
    
    $(".report").on("click",function(e){
        
        var time = $("#prescription").val();
        var areaCheck = $('.checkboxArea input[name="pubRangeName"]:checked').length;
        var relaseChannel = $('.checkbox_style input[name="channelCheckBoxes"]:checked').length;
        var publicshName = $('input[name="publisher"]').val();
        var isserName = $('input[name="issuer"]').val();
        if(time=="" || time=="undefined"){
            alertWin("时效不能为空");
            return false;
        }else if(areaCheck ==0){
            alertWin("请选择区域");
            return false;
        }else if(relaseChannel == 0){
            alertWin("请选择发布渠道");
            return false;
        }else if(publicshName == "" || publicshName == "undefined"){
            alertWin("请输入操作人员");
            return false;
        }else if(isserName == "" || isserName == "undefined"){
            alertWin("请输入部门领导");
            return false;
        }

        
        
        $(".m-poplayer").fadeIn(200);
        /*添加popup内容*/
        var _body = '<div class="popup_bd">'
            + '</div>'
            + '<div class="popup_bottom">'
            + '<a href="javascript:void(0)" class="m-btn m-confirm">确定</a>'
            + '<a href="javascript:void(0)" class="m-btn m-home-cancel">取消</a>'
            + '</div>';
        /*弹窗位置*/

        //发布弹窗在屏幕中间
        var leftWidth = ($(window).width() - 486) / 2; 
        $(".m-poplayer").find("div.popup_con").css("left", leftWidth).css("height", "390px").width(486).html(_body);
        /*添加popup_bd内容部分*/
        var _cent = '<div class="m-poplayer-table"><table><thead><tr><td colspan="2" style="text-align: center">预警发布申请</td></tr></thead>';
        var map = {};
        var informations = '';
        $(".checkbox_style").each(function(i,item){
            if($(item).find(".radioclass").is(':checked')){
                var releaseEName = $(item).find(".radioclass").val();
                var releaseCName = $(item).find("span").text();
                var channelId = $(item).find(".radioclass").attr("id");
                var releaseVal = $(".channelContentSel[name='"+releaseEName+"']").val();
                informations += channelId+','+releaseVal+'&';
                map[""+releaseCName+""] = releaseVal;
                _cent+='<tr><td>'+releaseCName+'</td><td class="t-blue t-ellip"><span>'+ releaseVal+'</span></td></tr>';
            }
        });
        _cent+= '</table></div>';
        $(".m-poplayer").find("div.popup_bd").append(_cent);
        $(".m-poplayer").find("div.popup_bd").find("li.publish").css("border-bottom", "none").css("line-height","25px").css("text-align","center");
        $(".m-poplayer").find("div.popup_bd").find(".m-text-textarea").css("margin-top","30px").css("width","66%");
        $(".m-poplayer").find("div.popup_bd").find("p.text").css("margin-left","45%");
        $(".m-poplayer").find(".popup_bottom").css("bottom","10px");

        /*点击确定*/
        $(".m-btn.m-confirm").on("click", function () {
            $(".m-poplayer").fadeIn(200);
             _body = '<div class="popup_bd">'
                 + '</div>'
                 + '<div class="popup_bottom" style="width: 60px;">'
                 + '<a href="javascript:void(0)" class="m-btn m-confirm" style="margin-left: 0px;">确定</a>'
                 + '</div>';
             /*弹窗位置*/
             //发布弹窗在屏幕中间
             var leftWidth = ($(window).width() - 486) / 2; 
             $(".m-poplayer").find("div.popup_con").css("left", leftWidth).css("height", "150px").width(350).html(_body);
             /*添加popup_bd内容部分*/
             $(".m-poplayer").find("div.popup_bd").append("<ul><li class='publish'><span>上报成功！</span></li></ul>");
             $(".m-poplayer").find("div.popup_bd").find("li.publish").css("border-bottom", "none").css("line-height","25px").css("text-align","center");
             $(".m-poplayer").find("div.popup_bd").find(".m-text-textarea").css("margin-top","30px").css("width","66%");
             $(".m-poplayer").find("div.popup_bd").find("p.text").css("margin-left","45%");

             //确定
             $(".m-btn.m-confirm").on("click", function () {
                 $(".m-poplayer").fadeOut();
             });
             setTimeout(function () { 
                 $(".m-poplayer").fadeOut(200);
                 var form = document.getElementById('form');   
                 form.action = "/sev/alarm/saveExternalAlarm";
                 form.submit();
             }, 1000);
            
        });
        /*点击取消*/
        $(".m-btn.m-home-cancel").on("click", function () {
            $(".m-poplayer").fadeOut(200);
        });

        //气泡功能测试
        /*var td_ellip=$(".m-poplayer-table tr td.t-ellip");
        var td_tiplist=$(".m-poplayer-table tr td.t-tip");
        //省略号
        var num;
        td_ellip.on("mouseover", function() {
            num = $(this).parent().index();
            var isLoad = $(this).find(".bubble-box").length > 0;
            if (isLoad) {
                $(this).find(".bubble-box").show();
            } else {
                var str = "";
                var strName = $(this).prev().text();
                for(var key in map){
                    if(key == strName){
                        str = map[key];
                    }
                }
                var content = "<div class='bubble-box bb-ellip'><p class='d-text'><span>"+str+"</span></p><i class='m-arrow'></i></div>";
                $(this).append(content);
            }
        });
        td_ellip.on("mouseout", function() {
            $(this).find(".bubble-box").hide();
        });*/
        /*判断文字是否溢出
        $(".m-poplayer-table tr td span").each(function(i,item){
            var maxwidth = 400; 
                if($(item).width()> maxwidth){        
                $(item).text($(item).text().substring(0,33));
                $(item).html($(item).html()+'…');
            }
        });*/
        return false;
    })
});
</script>